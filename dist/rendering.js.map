{"version":3,"sources":["../src/rendering.js"],"names":[],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport vis from './vis';\n\nexport default function link(scope, elem, attrs, ctrl) {\n  var data, panel, position;\n  elem = elem.find('.graph3d-panel');\n\n  ctrl.events.on('render', function() {\n    render();\n    ctrl.renderingCompleted();\n  });\n\n  function setElementHeight() {\n    try {\n      var height = ctrl.height || panel.height || ctrl.row.height;\n      if (_.isString(height)) {\n        height = parseInt(height.replace('px', ''), 10);\n      }\n\n      height -= 5; // padding\n      height -= panel.title ? 24 : 9; // subtract panel title bar\n\n      elem.css('height', height + 'px');\n\n      return true;\n    } catch(e) { // IE throws errors sometimes\n      return false;\n    }\n  }\n\n  function render() {\n    if (!ctrl.data) { return; }\n\n    data = ctrl.data;\n    panel = ctrl.panel;\n\n    if (setElementHeight()) {\n      addGraph3d();\n    }\n  }\n\n  function getKey(arr, val) {\n    return parseInt(_.keys(arr).find(function(key) {\n      return arr[key] == val;\n    }));\n  }\n\n  function onCameraPositionChange(event) {\n    ctrl.currentCameraPosition = {\n      horizontal: event.horizontal,\n      vertical: event.vertical,\n      distance: event.distance\n    };\n  }\n\n  function addGraph3d() {\n    if (data.length === 0) {\n      return;\n    }\n\n    var labels = _.pluck(data, 'label');\n\n    var datapoints = [];\n    datapoints.push(_.map(data[0].datapoints, function(dp) {\n      return dp[1];\n    }));\n    datapoints = datapoints.concat(_.map(data, function(serie) {\n      return _.map(serie.datapoints, function(dp) {\n        return dp[0];\n      });\n    }));\n\n    var valueLabels = _.map(datapoints, function(dp, i) {\n      if (i < 2) {\n        return _.uniq(dp);\n      }\n    });\n\n    // dataset\n    var graphdata = new vis.DataSet();\n    for (var i = 0; i < datapoints[0].length; i += 1) {\n      graphdata.add({\n        x: getKey(valueLabels[0], datapoints[0][i]),\n        y: getKey(valueLabels[1], datapoints[1][i]),\n        z: datapoints[2][i],\n        style: datapoints[2][i]\n      });\n    }\n\n    // prepare div for canvas\n    var plotDiv = document.createElement('div');\n\n    // css\n    var width = elem.width();\n    var height = elem.height();\n    $(plotDiv).css({\n      width: width + 'px',\n      height: height + 'px',\n      margin: 'auto',\n      position: 'relative'\n    });\n\n    // options\n    var options = {\n      width: width + 'px',\n      height: height + 'px',\n      axisColor: '#888888',\n\n      style:           panel.style,\n      showGrid:        true,\n      showShadow:      false,\n      showPerspective: panel.showPerspective || false,\n      verticalRatio:   panel.verticalRatio || 0.5,\n      keepAspectRatio: panel.keepAspectRatio || false,\n\n      xLabel: panel.xLabel || 'time',\n      yLabel: panel.yLabel || labels[0],\n      zLabel: panel.zLabel || labels[1],\n\n      xMin: panel.xMin || null,\n      yMin: panel.yMin || null,\n      zMin: panel.zMin || null,\n\n      xMax: panel.xMax || null,\n      yMax: panel.yMax || null,\n      zMax: panel.zMax || null,\n\n      xStep: panel.xStep || null,\n      yStep: panel.yStep || null,\n      zStep: panel.zStep || null,\n\n      xValueLabel: function(key) {\n        return valueLabels[0][key] + (panel.xUnit || '');\n      },\n      yValueLabel: function(key) {\n        return valueLabels[1][key] + (panel.yUnit || '');\n      },\n      zValueLabel: function(key) {\n        return key + (panel.zUnit || '');\n      },\n\n      tooltip: function (point) {\n         return (panel.xLabel || 'time') + ': ' +\n                valueLabels[0][point.x] + (panel.xUnit || '') + '<br>' +\n                (panel.yLabel || labels[0]) + ': ' +\n                valueLabels[1][point.y] + (panel.yUnit || '')  + '<br>' +\n                (panel.zLabel || labels[1]) + ': ' +\n                '<b>' + point.z + (panel.zUnit || '') + '</b>';\n      }\n    };\n\n    for (var key in options) {\n        if (options[key] === null) {\n           delete options[key];\n        }\n    }\n\n    // draw\n    var graph3d = new vis.Graph3d(plotDiv, graphdata, options);\n    graph3d.on('cameraPositionChange', onCameraPositionChange);\n    graph3d.setCameraPosition(panel.cameraPosition);\n\n    elem.html(plotDiv);\n    graph3d.redraw();\n  }\n}\n\n"]}