{"version":3,"sources":["../src/rendering.js"],"names":[],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport vis from './vis';\n\nexport default function link(scope, elem, attrs, ctrl) {\n  var data, panel;\n  elem = elem.find('.graph3d-panel');\n\n  ctrl.events.on('render', function() {\n    render();\n    ctrl.renderingCompleted();\n  });\n\n  function setElementHeight() {\n    try {\n      var height = ctrl.height || panel.height || ctrl.row.height;\n      if (_.isString(height)) {\n        height = parseInt(height.replace('px', ''), 10);\n      }\n\n      height -= 5; // padding\n      height -= panel.title ? 24 : 9; // subtract panel title bar\n\n      elem.css('height', height + 'px');\n\n      return true;\n    } catch(e) { // IE throws errors sometimes\n      return false;\n    }\n  }\n\n  function render() {\n    if (!ctrl.data) { return; }\n\n    data = ctrl.data;\n    panel = ctrl.panel;\n\n    if (setElementHeight()) {\n      addGraph3d();\n    }\n  }\n\n  function getKey(arr, val) {\n    return parseInt(_.keys(arr).find(function(key) {\n      return arr[key] == val;\n      }));\n  }\n\n  function addGraph3d() {\n    var labels = _.pluck(data, 'label');\n\n    var datapoints = [];\n    datapoints.push(_.map(data[0].datapoints, function(dp) {\n      return dp[1];\n    }));\n    datapoints = datapoints.concat(_.map(data, function(serie) {\n      return _.map(serie.datapoints, function(dp) {\n        return dp[0];\n      });\n    }));\n\n    var valueLabels = _.map(datapoints, function(dp, i) {\n      if (i < 2) {\n        return _.uniq(dp);\n      }\n    });\n\n    // dataset\n    var graphdata = new vis.DataSet();\n    for (var i = 0; i < datapoints[0].length; i += 1) {\n      graphdata.add({\n        x: getKey(valueLabels[0], datapoints[0][i]),\n        y: getKey(valueLabels[1], datapoints[1][i]),\n        z: datapoints[2][i],\n        style: datapoints[2][i]\n      });\n    }\n\n    // prepare div for canvas\n    var plotDiv = document.createElement('div');\n\n    // css\n    var width = elem.width();\n    var height = elem.height();\n    var size = Math.min(width, height) - 20;\n    $(plotDiv).css({\n      width: size + 'px',\n      height: size + 'px',\n      margin: 'auto',\n      position: 'relative'\n    });\n\n    // options\n    var options = {\n      width: size + 'px',\n      height: size + 'px',\n      style: 'bar',\n      showPerspective: true,\n      showGrid: true,\n      showShadow: false,\n      verticalRatio: 0.5,\n\n      xLabel: 'time',\n      yLabel: labels[0],\n      zLabel: labels[1],\n\n      xValueLabel: function(key) {\n        return valueLabels[0][key];\n      },\n      yValueLabel: function(key) {\n        return valueLabels[1][key];\n      },\n\n      tooltip: function (point) {\n         return 'time: '+ valueLabels[0][point.x] + '<br>' +\n                labels[0] + ': ' + valueLabels[1][point.y] + '<br>' +\n                labels[1] + ': <b>' + point.z + '</b>';\n      }\n    };\n\n    // draw\n    var graph = new vis.Graph3d(plotDiv, graphdata, options);\n    elem.html(plotDiv);\n    graph.redraw();\n  }\n}\n\n"]}